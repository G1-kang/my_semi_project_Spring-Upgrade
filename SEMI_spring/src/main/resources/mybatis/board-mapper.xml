<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.semi.update.mapper.Board">

	<resultMap type = "boardDto" id = "ResultMap">
		<result property = "boardNo" column = "BOARD_NO"/>
		<result property = "id" column = "ID"/>
		<result property = "memberName" column = "BOARD_NAME"/>
		<result property = "boardTitle" column = "BOARD_TITLE"/>
		<result property = "boardContent" column = "BOARD_CONTENT"/>
		<result property = "boardRegdate" column = "BOARD_REGDATE"/>
		<result property = "boardLike" column = "BOARD_LIKE"/>
		<result property = "filePath" column = "BOARD_FILEPATH"/>
		<result property = "imgPath" column = "BOARD_IMGPATH"/>
		<result property = "thumbnail" column = "BOARD_THUMBNAIL"/>
	</resultMap>
	
	<insert id="insertImg" parameterType="boardDto">
		INSERT INTO FREE_BOARD(BOARD_NO, ID, BOARD_IMGPATH, BOARD_THUMBNAIL) 
		VALUES(FREE_BOARD_SEQ.NEXTVAL, #{id}, #{imgPath}, #{thumbnail})
	</insert>
	
	<select id="getBoardNo" parameterType="boardDto" resultMap="ResultMap">
		SELECT BOARD_NO FROM FREE_BOARD
		WHERE ID = #{id}
		AND BOARD_THUMBNAIL = #{thumbnail}
	</select>
	
	
	<!-- 이미지 추가후 나머지 내용 update -->
	<update id="updateRestContent" parameterType="boardDto">
		UPDATE FREE_BOARD
		SET BOARD_NAME = #{memberName}, BOARD_TITLE = #{boardTitle}, BOARD_CONTENT = #{boardContent}, BOARD_REGDATE = SYSDATE, BOARD_LIKE = 0, BOARD_FILEPATH = #{filePath}
		WHERE ID = #{id}
		AND BOARD_NO = #{boardNo}
	</update>
	
	<!-- 이미지 추가 안했을때 board insert -->
	<insert id="insertNoImgBoard" parameterType="boardDto">
		INSERT INTO FREE_BOARD 
		VALUES(FREE_BOARD_SEQ.NEXTVAL, #{id}, #{memberName}, #{boardTitle}, #{boardContent}, SYSDATE, 0, #{filePath}, null, null)
	</insert>
	
	
	<!-- 전체 가져오기  + 검색 -->
	<!--
		# <trim>
		1.prefix 처리 후 엘리먼트의 내용이 있으면 가장 앞에 붙여준다.
		2.prefixOverrides 처리 후 엘리먼트 내용 중 가장 앞에 해당 문자들이 있다면 자동으로 지워준다.
		3.suffix 처리 후 엘리먼트 내에 내용이 있으면 가장 뒤에 붙여준다.
		4.suffixOverrides 처리 후 엘리먼트 내용 중 가장 뒤에 해당 문자들이 있다면 자동으로 지워준다.
	-->
	<select id="boardList" parameterType="boardDto" resultMap="ResultMap">
		SELECT * FROM FREE_BOARD
		<trim prefix = "WHERE" prefixOverrides = "AND">
			<if test="category == 'title' and keyword != null and keyword != ''">
				AND BOARD_TITLE LIKE ('%' || #{keyword} || '%')
			</if>
			<if test="category == 'content' and keyword != null and keyword != ''">
				AND BOARD_CONTENT LIKE ('%' || #{keyword} || '%')
			</if>
			<if test="category == 'name' and keyword != null and keyword != ''">
				AND BOARD_NAME LIKE ('%' || #{keyword} || '%')
			</if>
		</trim>
	</select>
	
	
	


	
    

</mapper>
